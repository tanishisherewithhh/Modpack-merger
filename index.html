<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Smart ModPack Merger/Combiner | Combine Minecraft .mrpack Files</title>
    <link rel="icon" href="https://github.com/tanishisherewithhh.png">
    <meta name="description" content="A free browser-based tool to merge multiple Minecraft .mrpack files. Automatically resolve conflicts and validate Minecraft versions and mod loaders safely.">
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jszip/3.10.1/jszip.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/FileSaver.js/2.0.5/FileSaver.min.js"></script>
    <style>
        :root {
            --bg-color: #1e1e2e;
            --card-bg: #2a2a40;
            --text-color: #e0e0e0;
            --accent: #89b4fa;
            --success: #a6e3a1;
            --danger: #f38ba8;
            --warning: #f9e2af;
            --border: #45475a;
            --terminal-bg: #11111b;
        }

        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background-color: var(--bg-color);
            color: var(--text-color);
            margin: 0;
            padding: 20px;
            display: flex;
            flex-direction: column;
            align-items: center;
            min-height: 100vh;
        }

        h1 { color: var(--accent); margin-bottom: 5px; }
        .subtitle { color: #a6adc8; margin-bottom: 20px; text-align: center; font-size: 0.9rem; max-width: 600px; }

        .container {
            width: 100%;
            max-width: 850px;
            background: var(--card-bg);
            padding: 25px;
            border-radius: 12px;
            box-shadow: 0 10px 30px rgba(0,0,0,0.5);
        }

        #error-banner {
            background: rgba(243, 139, 168, 0.15);
            border: 1px solid var(--danger);
            color: var(--danger);
            padding: 12px;
            border-radius: 6px;
            margin-bottom: 20px;
            display: none;
            font-weight: bold;
            text-align: center;
        }

        .drop-zone {
            border: 2px dashed var(--border);
            border-radius: 8px;
            padding: 25px;
            text-align: center;
            transition: 0.3s;
            cursor: pointer;
            margin-bottom: 20px;
        }
        .drop-zone:hover { border-color: var(--accent); background: rgba(137, 180, 250, 0.05); }

        .pack-list { list-style: none; padding: 0; margin: 0; max-height: 300px; overflow-y: auto; }
        .pack-item {
            background: var(--bg-color);
            border: 1px solid var(--border);
            margin-bottom: 8px;
            padding: 12px;
            border-radius: 6px;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }
        .pack-item.valid { border-left: 4px solid var(--success); }
        .pack-item.invalid { border-color: var(--danger); background: rgba(243, 139, 168, 0.05); }

        .pack-info { display: flex; flex-direction: column; gap: 4px; }
        .pack-header { font-weight: bold; display: flex; gap: 10px; align-items: center; }
        .pack-meta { font-size: 0.8em; color: #888; display: flex; gap: 8px; }
        .meta-tag { background: #313244; padding: 2px 6px; border-radius: 4px; }
        .meta-error { color: var(--danger); font-weight: bold; }

        .controls button {
            background: #313244;
            border: 1px solid var(--border);
            color: var(--text-color);
            cursor: pointer;
            padding: 4px 8px;
            border-radius: 4px;
            margin-left: 4px;
        }
        .controls button:hover:not(:disabled) { background: var(--accent); color: var(--bg-color); }
        .controls button.remove:hover { background: var(--danger); color: white; }

        #log-area {
            background: var(--terminal-bg);
            color: #cdd6f4;
            font-family: 'Consolas', 'Monaco', monospace;
            padding: 15px;
            border-radius: 6px;
            margin-top: 20px;
            height: 180px;
            overflow-y: auto;
            font-size: 0.85rem;
            border: 1px solid var(--border);
            line-height: 1.4;
        }
        .log-entry { margin-bottom: 2px; }
        .log-entry.success { color: var(--success); }
        .log-entry.error { color: var(--danger); }
        .log-entry.warn { color: var(--warning); }
        .log-entry.system { color: var(--accent); font-weight: bold; }

        .action-area {
            margin-top: 20px;
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding-top: 15px;
            border-top: 1px solid var(--border);
        }

        .btn {
            padding: 12px 28px;
            border: none;
            border-radius: 6px;
            cursor: pointer;
            font-weight: bold;
            transition: 0.2s;
        }
        .btn-primary { background: var(--accent); color: var(--bg-color); }
        .btn-primary:disabled { background: var(--border); cursor: not-allowed; opacity: 0.5; }

        footer {
            margin-top: 30px;
            text-align: center;
            font-size: 0.8rem;
            color: #6e738d;
        }
        footer p { margin: 5px 0; }
        .credits-name { color: var(--accent); font-weight: bold; text-decoration: none; }
    </style>
</head>
<body>

    <h1>Smart ModPack Merger</h1>
    <div class="subtitle">
        A tool to combine multiple Modrinth .mrpack files into one. 
        Safely merge Minecraft modpacks with automatic version and loader validation.
    </div>

    <div class="container">
        <div id="error-banner"></div>

        <div class="drop-zone" onclick="document.getElementById('fileInput').click()">
            <strong>Click to add .mrpack files</strong> or drag and drop them here
            <input type="file" id="fileInput" multiple accept=".mrpack" style="display:none">
        </div>

        <ul class="pack-list" id="packList">
            <li style="text-align:center; padding: 20px; color: #585b70;">Your modpack queue is empty.</li>
        </ul>

        <div id="log-area">
            <div class="log-entry system">Ready to merge...</div>
        </div>

        <div class="action-area">
            <div id="status-text" style="font-size: 0.9rem; color: #a6adc8;">0 packs ready for processing.</div>
            <button class="btn btn-primary" id="mergeBtn" onclick="mergePacks()" disabled>Merge & Export Pack</button>
        </div>
    </div>

    <footer>
        <p>&copy; 2026 ModPack Merger Tool. All rights reserved.</p>
        <p>Developed with ❤️ for the Minecraft Community by 
            <a href="https://github.com/tanishisherewithhh" class="credits-name" target="_blank">tanishisherewith</a>
        </p>
        <div style="margin-top: 15px;">
            <a href="https://github.com/tanishisherewithhh/Modpack-merger" target="_blank" style="text-decoration: none;">
                <button class="btn" style="background: #313244; color: var(--text-color); font-size: 0.8rem; padding: 8px 16px; border: 1px solid var(--border);">
                    View on GitHub
                </button>
            </a>
        </div>
    </footer>

<script>
    let loadedPacks = [];
    let currentGlobalError = null;

    const logArea = document.getElementById('log-area');
    const mergeBtn = document.getElementById('mergeBtn');
    const packList = document.getElementById('packList');
    const errorBanner = document.getElementById('error-banner');
    const statusText = document.getElementById('status-text');

    function log(msg, type = 'info') {
        const div = document.createElement('div');
        div.className = `log-entry ${type}`;
        div.textContent = `[${new Date().toLocaleTimeString()}] ${type === 'error' ? '✖ ' : '> '}${msg}`;
        logArea.appendChild(div);
        logArea.scrollTop = logArea.scrollHeight;
    }

    document.getElementById('fileInput').addEventListener('change', async (e) => {
        const files = Array.from(e.target.files);
        for (const file of files) {
            if (!file.name.endsWith('.mrpack')) {
                log(`Skipped ${file.name}: Not a .mrpack`, 'warn');
                continue;
            }
            try {
                log(`Reading ${file.name}...`);
                const zip = await JSZip.loadAsync(file);
                const indexData = await zip.file("modrinth.index.json").async("string");
                const index = JSON.parse(indexData);
                
                const deps = index.dependencies || {};
                const mc = deps.minecraft || "Unknown";
                const loader = Object.keys(deps).find(k => k !== "minecraft") || "None";

                loadedPacks.push({
                    id: Math.random(),
                    filename: file.name,
                    displayName: index.name || file.name,
                    zip,
                    metadata: index,
                    mcVersion: mc,
                    loaderType: loader,
                    error: null
                });
                log(`Successfully loaded ${index.name}`, 'success');
            } catch (err) {
                log(`Failed to parse ${file.name}: ${err.message}`, 'error');
            }
        }
        validateAndRender();
    });

    function validateAndRender() {
        currentGlobalError = null;
        if (loadedPacks.length > 0) {
            const master = loadedPacks[0];
            log(`Validating against Primary: ${master.displayName} (${master.mcVersion}/${master.loaderType})`, 'system');

            loadedPacks.forEach((pack, i) => {
                pack.error = null;
                if (i === 0) return;

                if (pack.mcVersion !== master.mcVersion) {
                    pack.error = `Version Mismatch (${pack.mcVersion} vs ${master.mcVersion})`;
                    currentGlobalError = "Minecraft version mismatch.";
                } else if (pack.loaderType !== master.loaderType) {
                    pack.error = `Loader Mismatch (${pack.loaderType} vs ${master.loaderType})`;
                    currentGlobalError = "Mod loader mismatch.";
                }
            });
        }
        renderUI();
    }

    function renderUI() {
        packList.innerHTML = '';
        if (loadedPacks.length === 0) {
            packList.innerHTML = '<li style="text-align:center; padding: 20px; color: #585b70;">Queue is empty.</li>';
            mergeBtn.disabled = true;
            statusText.textContent = "Waiting for input...";
            errorBanner.style.display = 'none';
            return;
        }

        loadedPacks.forEach((pack, idx) => {
            const li = document.createElement('li');
            li.className = `pack-item ${pack.error ? 'invalid' : 'valid'}`;
            li.innerHTML = `
                <div class="pack-info">
                    <div class="pack-header">
                        <span style="color:${idx===0?'var(--accent)':'#fff'}">${idx===0?'★ MASTER':`#${idx+1}`}</span>
                        <span>${pack.displayName}</span>
                    </div>
                    <div class="pack-meta">
                        <span class="meta-tag">${pack.mcVersion}</span>
                        <span class="meta-tag">${pack.loaderType}</span>
                        ${pack.error ? `<span class="meta-error">⚠️ ${pack.error}</span>` : ''}
                    </div>
                </div>
                <div class="controls">
                    <button onclick="move(${idx}, -1)" ${idx===0?'disabled':''}>▲</button>
                    <button onclick="move(${idx}, 1)" ${idx===loadedPacks.length-1?'disabled':''}>▼</button>
                    <button class="remove" onclick="removePack(${idx})">✕</button>
                </div>
            `;
            packList.appendChild(li);
        });

        if (currentGlobalError) {
            errorBanner.textContent = `⛔ Merge Denied: ${currentGlobalError}`;
            errorBanner.style.display = 'block';
            mergeBtn.disabled = true;
            statusText.textContent = "Resolve version conflicts.";
        } else {
            errorBanner.style.display = 'none';
            mergeBtn.disabled = false;
            statusText.textContent = `${loadedPacks.length} packs ready.`;
        }
    }

    function move(idx, dir) {
        const target = idx + dir;
        [loadedPacks[idx], loadedPacks[target]] = [loadedPacks[target], loadedPacks[idx]];
        log(`Moved ${loadedPacks[target].displayName}`);
        validateAndRender();
    }

    function removePack(idx) {
        log(`Removed ${loadedPacks[idx].displayName}`);
        loadedPacks.splice(idx, 1);
        validateAndRender();
    }

    async function mergePacks() {
        if (currentGlobalError) return;
        mergeBtn.disabled = true;
        mergeBtn.textContent = "Merging...";
        log("Starting Merge Operation...", "system");

        try {
            const outZip = new JSZip();
            const master = loadedPacks[0];
            
            let finalIndex = {
                formatVersion: master.metadata.formatVersion || 1,
                game: 'minecraft',
                versionId: "merged-" + Date.now(),
                name: "Merged Modpack Distribution",
                summary: "Combined modpack created via Smart Merger",
                files: [],
                dependencies: master.metadata.dependencies
            };

            const remotePathRegistry = new Set();
            const overridePathRegistry = new Set();

            for (const pack of loadedPacks) {
                log(`Injecting content from: ${pack.displayName}...`);
                
                pack.metadata.files.forEach(f => {
                    if (!remotePathRegistry.has(f.path)) {
                        finalIndex.files.push(f);
                        remotePathRegistry.add(f.path);
                    } else {
                        log(`Skipped duplicate remote file: ${f.path}`, 'warn');
                    }
                });
                const zipFiles = Object.keys(pack.zip.files);
                for (let path of zipFiles) {
                    if (path.startsWith("overrides/") && !pack.zip.files[path].dir) {
                        const internalPath = path.replace("overrides/", "");
                        
                        if (!overridePathRegistry.has(internalPath)) {
                            const content = await pack.zip.file(path).async("uint8array");
                            outZip.file(path, content);
                            overridePathRegistry.add(internalPath);
                        } else {
                            log(`Config Conflict: Kept priority version of ${internalPath}`, 'warn');
                        }
                    }
                }
            }

            outZip.file("modrinth.index.json", JSON.stringify(finalIndex, null, 2));
            
            log("Generating final .mrpack archive...");
            const blob = await outZip.generateAsync({
                type: "blob",
                compression: "DEFLATE",
                compressionOptions: { level: 6 }
            });

            saveAs(blob, "merged-pack.mrpack");
            log("SUCCESS: Pack exported! Ready for import to Prism, Modrinth, or MultiMC.", "success");
            
        } catch (err) {
            log(`CRITICAL ERROR: ${err.message}`, "error");
            console.error(err);
        } finally {
            mergeBtn.disabled = false;
            mergeBtn.textContent = "Merge & Export Pack";
        }
    }
</script>
</body>
</html>

